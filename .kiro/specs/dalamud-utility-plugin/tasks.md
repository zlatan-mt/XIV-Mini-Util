# Implementation Plan

## Tasks

- [ ] 1. プロジェクト基盤のセットアップ
- [ ] 1.1 (P) プラグインプロジェクトの作成と初期設定
  - Dalamud.NET.Sdk 14.0.1を使用した.NET 10プロジェクトの作成
  - プラグインマニフェストの設定（プラグイン名、作者、説明）
  - 必要なNuGetパッケージ参照の追加（FFXIVClientStructs、Lumina）
  - _Requirements: 1.1, 1.2, 1.5_

- [ ] 1.2 (P) Configurationクラスの実装
  - IPluginConfigurationを実装した設定クラスの作成
  - マテリア精製と分解のデフォルト設定値の定義
  - ジョブ条件の列挙型（Any, CrafterOnly, BattleOnly）の定義
  - 設定の保存メソッドの実装
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [ ] 1.3 プラグインエントリーポイントの実装
  - IDalamudPluginインターフェースの実装
  - Dalamudサービスの依存性注入による取得
  - スラッシュコマンド（/xivminiutil）の登録
  - Disposeでの全リソース解放処理
  - 1.1と1.2の完了後に実施
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 4.1, 4.2, 4.3_

- [ ] 2. データアクセスサービスの実装
- [ ] 2.1 (P) InventoryServiceの実装
  - 所持品とアーマリーチェストのスキャン機能
  - アイテム情報（ID、名前、レベル、スピリットボンド）の取得
  - マテリア精製可能アイテムの判定（スピリットボンド100%）
  - 分解可能アイテムの判定とレベルフィルタリング
  - 最高アイテムレベルの算出機能
  - プレイヤーログイン状態のチェック
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5_

- [ ] 2.2 (P) JobServiceの実装
  - 現在のプレイヤージョブ取得機能
  - クラフター判定（ジョブID 8-15）
  - 戦闘職判定（クラフター以外）
  - ジョブ条件チェック機能（Any/CrafterOnly/BattleOnly）
  - ログアウト時の機能無効化対応
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5, 9.6, 9.7_

- [ ] 3. マテリア精製機能の実装
- [ ] 3.1 MateriaExtractServiceの実装
  - 有効/無効状態の管理
  - フレーム更新イベントへの登録
  - 精製可能アイテムの検索処理
  - ゲームUIを通じたマテリア精製の実行
  - 精製完了後の次アイテム検索
  - 処理中状態の管理
  - 精製結果のログ出力
  - InventoryServiceへの依存（2.1完了後）
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 10.2_

- [ ] 4. アイテム分解機能の実装
- [ ] 4.1 DesynthServiceの基本実装
  - 分解処理の開始/停止機能
  - レベル範囲によるアイテムフィルタリング
  - 分解対象アイテムの順次処理
  - ゲームUIを通じた分解実行
  - 分解結果のログ出力
  - InventoryServiceとJobServiceへの依存（2.1, 2.2完了後）
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5, 10.3_

- [ ] 4.2 高レベルアイテム警告機能の実装
  - 最高アイテムレベルからの閾値判定
  - 警告対象アイテムの検出
  - 警告情報（アイテム名、レベル）の生成
  - 警告イベントの発火
  - ユーザー確認待ち状態の管理
  - 確認結果に基づく処理継続/スキップ
  - 4.1完了後に実施
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 4.3 ジョブ条件による分解制御の実装
  - 分解開始前のジョブ条件チェック
  - 条件不一致時のエラー通知
  - ジョブ変更時の状態更新
  - 4.1完了後に実施
  - _Requirements: 8.3, 8.4, 8.5, 8.6_

- [ ] 5. ユーザーインターフェースの実装
- [ ] 5.1 MainWindowの実装
  - ImGuiベースのメインウィンドウ作成
  - マテリア精製のオン/オフボタン
  - アイテム分解の開始ボタン
  - 分解設定項目の表示（レベル範囲、ジョブ条件）
  - 処理状態の表示
  - サービスとの連携
  - 3.1, 4.1完了後に実施
  - _Requirements: 3.1, 3.4, 3.5, 3.6_

- [ ] 5.2 警告ダイアログの実装
  - モーダルダイアログの表示機能
  - 警告アイテム情報の表示
  - はい/いいえボタンの実装
  - ユーザー選択のサービスへの伝達
  - 4.2完了後に実施
  - _Requirements: 7.2, 7.3, 7.4, 7.5_

- [ ] 5.3 ConfigWindowの実装
  - 設定ウィンドウの作成
  - 分解レベル範囲の入力フィールド
  - ジョブ条件のドロップダウン選択
  - 警告設定の変更
  - 設定変更時の即座保存
  - 1.2完了後に実施可能
  - _Requirements: 3.2, 6.3, 8.2_

- [ ] 5.4 コマンドとウィンドウの統合
  - コマンド実行時のウィンドウ表示/非表示切り替え
  - 無効なサブコマンド時のヘルプ表示
  - ウィンドウのプラグインへの登録
  - 5.1, 5.3完了後に実施
  - _Requirements: 3.3, 4.2, 4.3_

- [ ] 6. エラーハンドリングとログ機能
- [ ] 6.1 統合ログ機能の実装
  - Dalamudログシステムを使用したログ出力
  - 精製/分解完了時のサマリーログ
  - エラー発生時のスタックトレース記録
  - ログレベルの適切な使い分け
  - 全サービスへの統合
  - _Requirements: 10.1, 10.2, 10.3, 10.4_

- [ ] 7. 統合テストと動作確認
- [ ] 7.1 全機能の統合テスト
  - プラグインのロード/アンロード動作確認
  - 設定の保存/読み込み確認
  - マテリア精製機能の動作確認
  - アイテム分解機能の動作確認
  - 警告ダイアログの動作確認
  - ジョブ条件の動作確認
  - エラー処理の動作確認
  - _Requirements: 1.3, 1.4, 2.2, 2.3, 5.3, 6.2, 7.2, 8.6_
